<!-- app/views/products/index.html.erb -->
<!DOCTYPE html>
<html>
<head>
  <title>Product</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container">
  <h1>Price History for "<%= @product_name %>"</h1>


    <tbody>
        <canvas id="measurementChart" width="400" height="200"></canvas>

        <script>
        document.addEventListener("DOMContentLoaded", function() {
            var ctx = document.getElementById('measurementChart').getContext('2d');
            var measurementChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: <%= raw @dates.map(&:to_s) %>, // Convert timestamps to string and pass as JSON
                datasets: [
                    <% @datasets.each do |dataset| %>
                        {
                            label: '<%= dataset[:label] %>',
                            data: <%= dataset[:data].to_s.gsub('nil', 'null') %>,
                            borderColor: '<%= dataset[:borderColor] %>',
                            backgroundColor: '<%= dataset[:backgroundColor] %>',
                            borderWidth: <%= dataset[:borderWidth] %>
                        },
                    <% end %>
                ]
            },
            options: {
                scales: {
                y: {
                    beginAtZero: true
                }
                }
            }
            });
        });
        </script>
    </tbody>

</div>

</body>
</html>
